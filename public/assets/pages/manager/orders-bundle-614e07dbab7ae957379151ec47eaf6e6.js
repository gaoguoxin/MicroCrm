(function(){$(function(){var e,t,a,c,r,n;return $("#search_start,#search_end").datepicker({dateFormat:"yy-mm-dd",showAnim:"show"}),a=function(e){return $.post("/manager/orders/get_employee",{data:e},function(e){return e.success?$.each(e.value,function(e,t){var a,c,r,n;return a="<div class='row'> <div class='box one whole success'> <div class='two sixths'>(\u7f16\u53f7)\u540d\u5b57:("+t.c_code+")"+t.c_name+"</div> <div class='one sixth'>\u57ce\u5e02:"+t.c_city+"</div> <div class='one sixth'>\u65e5\u671f:"+t.c_start+"</div> <div class='one sixth'>\u6559\u5e08:"+t.c_instructor+"</div> <div class='one sixth'>\u5269\u4f59\u540d\u989d:"+t.c_remain+"</div> </div> <div class='one whole'> <div class='row'> <ul class='checklist large turquoise'>",c="",$.each(t.e_arr,function(e,a){var r,n,i,o;return o="<li class='pull-left one third' data-id='"+t.c_id+"' data-u="+a.e_id+"  data-cancel= "+a.can_cancel+" data-enroll="+a.e_enroll,i=a.e_enroll?" aria-checked='true' ":"",n=" >"+a.e_name+"</li>",r=o+i+n,c+=r}),r="</ul</div></div></div>",n=a+c+r,$(".employee-box .content").append(n)}):void 0})},n=function(e){return $.fancybox.open($(".employee-box"),{padding:0,autoSize:!0,minWidth:1e3,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,closeClick:!1,css:{background:"rgba(51, 51, 51, 0.2)"}}},beforeShow:function(){return $(".employee-box .content").html(""),a(e)},afterClos:function(){return $(".employee-box .multiple_start_button").removeClass("success").addClass("info").text("\u786e\u5b9a")}})},c=function(e,t){return $.get("/manager/orders/get_order_list",{id:e},function(e){return $.each(e.value,function(e,a){var c,r,n,i;return i="<tr> <td class='align-center'>"+a.c_name+"</td><td class='align-center'>"+a.u_name+"</td><td class='align-center'>"+a.state+"</td><td class='align-center'>"+a.status+"</td> <td class='align-center'>"+a.presence+"</td> <td class='align-center'>",c="",t?a.is_cancel?c+="<a href='javascript:void(0);'>\u5df2\u53d6\u6d88\u62a5\u540d</a>":(a.can_cancel&&(c+="<a href='javascript:void(0);' data-c='"+a.c_id+"' data-u='"+a.u_id+"' data-id="+a.oid+" class='cancel-order'>\u53d6\u6d88\u62a5\u540d</a>&nbsp;"),a.is_check?c+=a.check_ok?"<a href='javascript:void(0);' data-c='"+a.c_id+"' data-u='"+a.u_id+"' class='refuse-order'>\u62d2\u7edd\u62a5\u540d</a>&nbsp;":"<a href='javascript:void(0);' data-c='"+a.c_id+"' data-u='"+a.u_id+"' class='check-order'>\u5141\u8bb8\u62a5\u540d</a>&nbsp;":(c+="<a href='javascript:void(0);' data-c='"+a.c_id+"' data-u='"+a.u_id+"' class='check-order'>\u5141\u8bb8\u62a5\u540d</a><br/>",c+="<a href='javascript:void(0);' data-c='"+a.c_id+"' data-u='"+a.u_id+"' class='refuse-order'>\u62d2\u7edd\u62a5\u540d</a>")):c+=a.is_cancel?"<a href='javascript:void(0);'>\u5df2\u53d6\u6d88\u62a5\u540d</a>":a.check_ok?"<a href='javascript:void(0);'>\u5df2\u5141\u8bb8\u62a5\u540d</a>":"<a href='javascript:void(0);'>\u5df2\u62d2\u7edd\u62a5\u540d</a>",n="</td></tr>",r=i+c+n,$(".order-list table tbody").append(r)})})},r=function(e,t){return $.fancybox.open($(".order-list"),{padding:0,autoSize:!0,minWidth:1e3,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,closeClick:!1,css:{background:"rgba(51, 51, 51, 0.2)"}}},beforeShow:function(){return $(".order-list .content table tbody").html(""),c(e,t)}})},e=function(e,t,a,c){return $.get("/manager/orders/check",{cid:e,uid:t,type:a},function(e){return e.success?(c.removeAttr("class"),c.text("refuse"===a?"\u5df2\u62d2\u7edd":"\u5df2\u540c\u610f")):void 0})},t=function(e){return $.post("/manager/orders",{data:e},function(e){return e.success?($.fancybox.close(),$(".employee-box .multiple_start_button").removeClass("info").addClass("success").text("\u606d\u559c\u60a8,\u62a5\u540d\u6210\u529f,\u8bf7\u7b49\u5f85\u7cfb\u7edf\u6559\u52a1\u5ba1\u6838\uff01"),window.location.href="/manager/orders?t=w"):void 0})},$("body").on("click",".search_course",function(e){var t;return e.preventDefault(),t=$("form.search-course").serialize(),$.get("/manager/orders",t,function(){})}),$("body").on("click",".pagination a",function(){var e,t,a,c,r,n,i,o;return!$(this).hasClass("disabled")&&(i=$(this).data("page"),n=$(this).data("name"),t=$(this).data("code"),a=$(this).data("content"),e=$(this).data("city"),o=$(this).data("start"),c=$(this).data("end"),r={page:i,name:n,code:t,content:a,city:e,start:o,end:c},i)?$.get("/manager/orders",r,function(){}):void 0}),$("body").on("click","table tr th .checklist li",function(){return"true"===$(this).attr("aria-checked")?$("table tr td li").attr("aria-checked",!0):$("table tr td li").attr("aria-checked",!1)}),$("body").on("click","button.start",function(){var e;return $('table tr td li[aria-checked="true"]').length>0&&(e=[],$('table tr td li[aria-checked="true"]').each(function(){return e.push($(this).data("id"))}),e.length>0)?n(e):void 0}),$("body").on("click",".employee-box li",function(){return $(this).data("cancel")===!1&&$(this).data("enroll")===!0?$(this).attr("aria-checked",!0):void 0}),$("body").on("click",".employee-box .multiple_start_button",function(){var e;return e=[],$(".employee-box ul li").each(function(){var t;return t="true"===$(this).attr("aria-checked")?"enroll":"cancel",e.push({c_id:$(this).data("id"),u_id:$(this).data("u"),type:t})}),t(e)}),$("body").on("click","a.show-order",function(){var e,t;return e=$(this).data("id"),t=$(this).data("opera"),r(e,t)}),$("body").on("click","a.refuse-order,a.check-order",function(){var t,a,c;return t=$(this).data("c"),c=$(this).data("u"),a=$(this).hasClass("refuse-order")?"refuse":"check",e(t,c,a,$(this))}),$("body").on("click","a.cancel-order",function(){var e,t;return e=$(this),t=$(this).data("id"),$.get("/manager/orders/cancel",{id:t},function(t){return t.success?e.removeAttr("class").text("\u5df2\u53d6\u6d88\u62a5\u540d"):void 0})}),$("body").on("click","button.close-box",function(){return $.fancybox.close()})})}).call(this);